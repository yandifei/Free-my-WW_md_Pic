# 鸣潮日常开发（开发随笔）
## 前言
开发的日子是2024.12.13
继承了4C脚本，对先前的模块进行开发
修复了之前填入数字太大导致溢出无法判断声骇刷取数量的问题，验证了脚本是针对32位机的猜想，数据类型得特别注意才行了
2024.12.13 增加了实时保存、用户自定义界面实时反馈、以及立即修改立即有效。
最大的修改是补足了36个热键的按钮，封装了游戏里所有的热键
## 模块开发
### 领取邮件
邮件领取搞定，有一键领取，点击一键领取次，第二次是为了点击任意地方关闭领取的物品的界面
### 活跃度领取
搞了好久终于观察到了，领取奖励按钮会变化，有2种情况，以下是观察日志
1. 鼠标在领取按钮长按后离开就会在原来不是全黑的按钮下发生变化变成全黑，如果除了第一个按钮外下面都是全黑按钮的，那么领取第一个后，下一个按钮就会变成第一个按钮此时不是全黑按钮的了。退出游戏后情况都不会改变，该全黑的按钮就全黑，没有全黑的按钮依旧不变。
2. 本来只有一个不是全黑的，我完成了一个任务后连带第一个领取按钮都变全黑了，我进行长按不领取的操作后又改变了领取图标。改变后的图标i哦活跃度的前往按钮，字体
3. 变为领取且套上了一层金色。这个相识度只能是0.9了，无论如何都颜色都会有细微的差别
4. 今天是2024.12.14，大号上线就做了2个活跃度任务，显示全黑，长按不领取奖励后就不是全黑了，完成一个活跃度任务后，所有的活跃度任务按钮又变成全黑了。
5. 在3个领取按钮全黑的情况做第4个任务，观测按钮是否变化：事实证明确实是全黑。注意：如果是点击任务列表的前往完成任务后记得要退出重新进去活跃度界面，我在点击前往完成调谐声骇的任务后图标没有变成全黑色
6. 观测前四个全黑按钮和最后一个不是全黑的有条纹按钮，领取第一个是是否发生变化：临接着的下一个任务跟了上来，图标不是全黑的。领取第一个之后跟上来的第二个按钮点击是可变化的，不是全黑的的
7. 观测4个全黑的按钮点击领取看看变化（没有进行其他操作）：观测到领取奖励后，下一个任务跟上来的按钮不是全黑了。
   1. 进阶6的操作后对第一按钮进行点击不领取操作：第一个按钮还是条纹的，不是全黑的按钮，其他按钮不变。
   2. 一直点击第一个领取后除了第一个图标不是全黑其他一切正常
结论是领取按钮有两种情况，第一种是全黑，这是最普遍的情况，第二种不是全黑，有条纹出现在按钮上。完成活跃度任务后默认都是全黑，但是如果鼠标移动到全黑的按钮，左击长按鼠标不松开，把鼠标位置移动至领取按钮外面，那么该全黑按钮就会改变，变成不是全黑且有条纹的按钮。只要做多一个活跃任务，全部按钮就都是全黑的了。
测试推测：刚开打开活跃度界面都是一样，所有按钮全黑，如果领取完第一个后，下一个跟着的任务的领取按钮就不是全黑了，继续领取后下一个领取按钮也会变得不是全黑，并且对第一个不是全黑的按钮进行点击不领取操作后不会不会变化，其他按钮还是可以发生变化的。解决方案：1.逆向思维(需要大量的数据支撑我的验证)2.正向思维：观测所有情况找出规律

脚本该模块已经写好了，用的是逆向思维，熟悉正向了，找到了正向的规律再去逆向写代码
感谢3467490867和2339370386
### 先约电台
这个模块也已经写好了，根据之前写原神和铁道的经验去写，优化了非常多，增加许多判断来提高执行速度，使用了人脑最有决策方案
### 邮件领取
这个模块也搞定了，感谢dndaa,QQ:1474671153给的兑换码让我有机会测试
### 体力模块开发
这是一个最大的模块，我致力于最大用户自定义，但是我不会像NOKIRUY这个up让用户填入太多的东西，如选择漂泊日志还是残像探寻的选择，能脚本多选择判断我绝对不会麻烦使用者，一切默认即为最好
### 无音区模块开发
今天是2024.12.15，以下是所有套装的简称，按照合鸣图鉴的顺序来的

冷凝套
热熔套
导电套
气动套
衍射套
湮灭套
隐世套
出云套
余音套
决断套
永驻套
隐匿套
共奏套
浪涛套

无音区
中曲台地(余音套、隐世套)
荒石高地I(气动套、冷凝套)
虎口山脉(冷凝套、导电套)
怨鸟泽(衍射套、余音套)
归虚港市(火套、隐世套)
荒石高地II(导电套、火套)
天光之森(湮灭套、出云套)
余音套和隐世套
气动套和冷凝套
冷凝套和导电套
衍射套和余音套
热熔套和隐世套
导电套和热熔套
湮灭套和出云套
预留预计总次数1
预留预计总次数2
预留预计总次数3
预留预计总次数4

https://ww.hakush.in/
内鬼爆料
增加5个套装
凌冽决断之心
此间永驻之光
幽夜隐匿之帷
高天共奏之曲
无惧浪涛之勇

4C声骇
叹息古龙
Lorele罗蕾莱
Sentry Construct异构武装
Hecate赫卡忒 周本boss

1. 考虑无音区双倍偏移问题
   检测是否存在双倍图标，检测到双倍图标后通过偏于原来的坐标达到不用太大更改之前坐标的效果
2. 考虑后续无音区增加问题
   提前添加无音区的选项后续在开放，预留数量为4个
3. 考虑结晶溶剂（体力浓缩）和结晶单质（备用体力的情况）
   输入框填99加上领取的是双倍，那么可以消耗198结晶溶剂（体力浓缩），如果使用单倍领取，那么也能消耗99个结晶溶剂（体力浓缩）

#### 大体逻辑撰写
假设了11个无音区，和之前一样给出选择，选择每一次打无音区是不是去不同的地方打，还是仅仅打一个无音区直到消耗达到一定体力才去别的地方打。
变量1：领取总次数(单倍是1次,双倍是2次)
变量2：领取总次数需要的体力（如果计算体力不够且不进行补充就继续完成任我或直接报错停止脚本）
变量3：当前结晶波片数量（体力）
变量4：使用结晶溶剂（体力浓缩）后结晶波片的数量
变量5：结晶单质（备用体力的情况）
变量6：使用结晶溶剂（体力浓缩）或结晶单质（备用体力）增加后有多少结晶波片数量（体力）
变量（11个）：记录不同无音区领取次数的数量
变量（11个）：不同无音区的领取次数(单倍是1次,双倍是2次)
此次的交替循环逻辑采用了case
顺序逻辑和交替逻辑搞定，退出循环的条件是所有无音区选项都是真,数组记录任务完成度
观测：即使没有结晶单质也还是有这个选项，没有结晶单质补充体力时会自动选择结晶溶剂
感谢2729854928，付出所有的结晶单质和结晶溶剂让我观测
如果结晶单质和结晶波片都用完了会默认选择星声
该模块运行时读取结晶波片，如果开启了补充结晶单质或结晶溶剂就读取他们的数量，

体力方案
1. 一直打对应的副本，如果没有体力就检测是否使用备用体力，如果备用体力都没了就检测是否使用浓缩体力，如果浓缩体力都没了就退出无音区的任务
2. 预测需要的总体力和我能给的体力，如果计算超标就退出脚本执行
3. 预测需要的总体力和我能给的体力，计算即使超标也正常执行，一旦检测到需要补充体力就退出脚本
4. 居中以上所有方案，预测需要的总体力和我能给的体力，一直打对应的副本，如果没有体力就检测是否使用备用体力，如果备用体力都没了就检测是否使用浓缩体力，如果浓缩体力都没了就退出无音区的任务
我选择方案4，计算体力数量，避免重复多打一次去判断体力不足
有空上yolo模型识别字体，字体变化无常，我的字库失效
如果无法预测体力，那还是多打一遍来判断体力是否需要补充退出循环吧

领取总次数需要的结晶波片 = (余音套和隐世套预计总次数 + 气动套和冷凝套预计总次数 + 冷凝套和导电套预计总次数 + 衍射套和余音套预计总次数 + 热熔套和隐世套预计总次数 + 导电套和热熔套预计总次数 + 湮灭套和出云套预计总次数 + 预留预计总次数1 + 预留预计总次数2 + 预留预计总次数3 + 预留预计总次数4) * 60
使用结晶溶剂获得的结晶波片 = 使用结晶溶剂的数量 * 60
无音区领取预计总次数 = 余音套和隐世套预计总次数 + 气动套和冷凝套预计总次数 + 冷凝套和导电套预计总次数 + 衍射套和余音套预计总次数 + 热熔套和隐世套预计总次数 + 导电套和热熔套预计总次数 + 湮灭套和出云套预计总次数 + 预留预计总次数1 + 预留预计总次数2 + 预留预计总次数3 + 预留预计总次数4


如果体力不够就赋值当前的计数数组为1，输出体力不够

#### 无音区传送模块
嫁接之前的4C但是改了很多，最开始没有用到数组，定义的超多全局变量。
之前是记录双倍记录就行了
因为觉得逻辑太烂了，所以2024.12.20爆改了逻辑，保留原来的递归，保留顺序和交替功能。
目前应该是最好的了，当前领取次数=自定义领取次数才退出循环
如果中途没有体力还会在有不同的决策
1. 如果无任何补充方式，如果当前领取次数不等于自定义，则把当前领取次数赋值到自定义领取次数，这样就是能够领取的最大次数了
2. 如果有补充方式，就使用补充，使用后再进行判断能否领取奖励，默认是双倍领取，如果使用补充后还是不足够，那么就判断能否是单倍领取（有单倍领取的话就单倍领取,领取完之后就把当前领取次数+1，把当前领取次数赋值到自定义领取次数），如果单倍领取也不行就把当前领取次数赋值到自定义领取次数
3. 什么领取方式都没有，当前领取次数赋值到自定义领取次数



#### 无音区战斗模块开发（已经到达无音区的地点）
第一个无音区就在眼前但是要自己走一小步才有开始选项
第二个无音区也是
第三个可直接开启
第四个可直接开启
第五个不可直接开启
第六个不可直接开启
第七个不可直接开启

如果在开始战斗后锁定敌人，那么下一波怪锁定就检测有没有锁定图标提示就行了

打完后不领取，无音区会进入冷却状态，刷新时间时1分钟。
**搭配索敌线程可以实现原地转圈圈，也就是可以调整方向**
即使是无音区还是无法通过检测一次UID和计时器来判断战斗结束，我估计这俩个合成为一个去检测才可以。双检测的函金量还在上升
采用双检测判断是否结束战斗
无音区计时刷新,刷新的情况时可能2波怪为一轮,时计时器刷新时会闪烁,闪烁时间是大于0.1秒的,击杀任务图标搞
检测计时器即为开始，不能单靠计时器，计时器会闪烁，检测计时器、UID、书本、左上角终端图标
双检测时间的话1秒时间是可以的，但是有很大概率照成技能浪费
深塔只有计时器没有击杀任务提示图标
2024.12.15|22：03无音区战斗模块搞好了。2024.12.18测试发现bug来修复
2024.12.18找到了另一个变量剔除了双检测，检测无音区挑战成功后屏幕出现的挑战成功图标
检测挑战成功图标的话也有一定的时间等待，要等挑战成功的图标弹出，只能说是目前最优吧
2024.12.21发现使用通用检测f通用交互按钮来检测boss、副本、无音区的到达会有误差,检测到ff通用交互按钮不一定能；立即停下
2024.12.21战斗结束判定觉得上ocr号，挑战结束字体颜色是会改变的
#### 无音区领取模块
使用之前的标志变量WW_selcet_tr_su_number来重新传送地图可以上yolo，但是不是最优决策，因此使用直接传送到附近点位
因为录视频的原因，我动了UID的图色检测，把之前的0.7该成了0.9（QQ录屏可以使用）
取消书本的地图传送，打完靠书本传送是不行的，，因为会显示无音区正在冷却，但是我可以直接打开大地图点击中心进行传送，但是有漏洞就是可能会误自动识别到其他的地区。
多信标的情况还要识别信标位置，在做多一个判断

第一个无音区有可能识别到伤痕的周本
第三个无音区有可能识别到辉萤军势和小型信标//实测
第四个无音区有可能识别到小型信标
第六个无音区有可能识别到小型信标

出现了提示补充结晶波片的界面后，右上角会有提示，此时可以检测结晶单质、结晶波片、星声的数量，补充结晶波片界面还有结晶溶剂的显示
点击结晶单质或检测结晶单质是否被点击，如果没有被点击，就点击结晶单质

为了兼容所有领取，所以我改了模块。打完无音区或boss等类似的地图后，重新传送往前走超过我指定的时间就重新传送，如果累计重新传送4次(可以自定义)就判定失效
为了兼容所有人，这里不能使用贪心算法
维里奈为标准(萝莉身形好兼容)boss传送领取奖励
无冠者 5.1
朔雷之鳞 6.4
云闪之鳞 4.8
燎照之骑 7.3
飞廉之猩得拐弯，不能直接走
哀声鸷 8.1
无常凶鹭 6.
辉萤军势 5.8
聚械机偶这个最好的解决方式就是锚点了
无归的谬误 9,不停冲刺的话3.4s

最晚的就是9秒，那就设置10秒好了，飞廉之猩和无归的谬误做特殊处理。如果做boss的话也要考虑地图信标干扰问题
因为目前是先做无音区的，所以暂时不考虑其他的领取问题

当体力不足时无音区激活是不会有提示的，所以判断体力不足只能是领取奖励的时候了，也就是要打多一次去判断体力不足，个人认为是浪费时间，所以上OCR在打之前检测是最好的了,目前就先做多打一次去判断是否体力不足，搞个双重保险即使OCR上不了也不代表不行了

普通副本是40和80，大世界的boss是60，无音区是60和120
无音区领取的时候如果短暂断网是没有问题的，连接上网络之后还是领取的界面并没有改变

考虑到网络问题，之后做一个检测网络的线程吧，如果领取中途卡了那就真难受了
**2024.12.18开始制作兼容副本无音区boss的领取模块**
**对补充体力的观测** 
点击除了体力补充的界面之后视为退出
没有体力之后点击领取奖励就会弹出补充结晶波片的界面
补充体力的时候会自动根据你选的领取方式去补充多少体力，假如我有41体力和31的备用体力，我选择60体力的领取方式，点击领取时会自动默认结晶单质，提取结晶单质时会自动提取一定的结晶单质来用，此时是自动提取19个备用体力。
如果我选择120领取方式就会提取最大值31
如果点击结晶溶剂或者是星声补充的话是直接使用的，不存在选择次数选项(这里一定要慎重去写脚本)

领取默认双倍得处理掉

先根据输入框来判断是否是否等于当前的的次数，如果不是就开打并进行双倍领取，如果是则执行下一个任务，设置一个标志位用来判断是不是单倍领取
如果双倍领取不够了，并且没有任何补充，但是有单倍领取的体力就使用单倍领取，并且退出设法退出无音区战斗模组
考虑到如果是为了清体力随便输入了一个大的奇数按照正常逻辑的话就会先单独刷一次单倍的无音区，个人觉得就是浪费时间所有必须改掉
单倍领取的情况：
1. 体力不足120但是够60
2. 挑战次数是奇数刚好需要一次单倍领取来补，得放到最后搞。

第二种情况判断最后一次的方法就是+2看是否大于指定的次数了，每次有要判断

弹窗能中断当前主程序但是不能中断主进程
退出脚本exit强
领取的是侯疯点f是没问题的，不会退出领取界面，只有鼠标点击空白区域和esc能退出
如果boss复活的话是未找到实体
***体力补充处理***
优先补充结晶单质，其次是结晶溶剂
缺一张1920X1080图：补充结晶波片界面结晶溶剂用完的图
提取结晶单质后是要点击任意界面的，点击完之后会回到体力补充界面
结晶溶剂也是一样的，估计星声也是一样的



##### 无音区模块优化
2024.12.21观测到如果直接传送有概率传送后视角不知正前方,移动一定时间重新领取也没有触发
移动一定时间重新领取也没有触发是因为数值计算错了,搞成了50秒

1. 加一个死亡检测，是检测队伍中是否存在个体死亡，即为灰色
判定死亡：
   1. 复活药界面
   2. 全队复活界面，副本内会不同
   3. 单个角色血条灰色
2. 加一个指定角色切换，考虑到像椿这样的角色影响技能行走
3. 原地传送后加一个视角矫正
4. OCR读取结晶溶剂、结晶单质、结晶波片的数据，进行计算，减少要多打一次去判断体力不足的情况
5. 无音区判断结束的条件是检测挑战成功的字体，但是字体刚出来的时候是颜色改变的，这里得上OCR或特殊字库

***问题解决***
1. 对重新传送数值进行修复
2. 传送后添加视角回正
3. 增加领取角色切换
4. 加一个死亡检测的难度较大切换方案
   1. 左上角的血条值会改变,即使全体死亡,灰度值都各不相同
   2. 如果考虑的的是血量低于30%出现的红色又是一个麻烦
   3. 已经做出检测第一个角色死亡的了，相似度0.6
   4. 检测3个位置的血条存在，但是切角色的时候会误判,找到了一个颜色点位不会被误判，即使切人有特效也不会误判。需要注意的是如果开大招了也会检测不到像素点
   5. 最后的死亡处理是打完怪物时检测是否有死亡，有死亡就复活继续打，没有就切人领取奖励

角色死亡检测小结：加了检测3个角色的像素点后不代表其他的白做，其他的可以直接判断是什么死亡并且反馈
OCR没时间上,优化4和优化5没搞


### 兑换码模块开发
今天是2024.12.21刚刚好是鸣潮前瞻就写了这个脚本

## 其他
今天是2024.12.26发现无声区的挑战成功图标和活动钳形激战无双版2的一样，都能使用拿来检测关卡打完了
